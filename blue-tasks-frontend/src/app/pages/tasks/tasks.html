<div class="mx-auto flex max-w-6xl flex-col gap-6 px-4 py-8">
  <div class="flex flex-wrap items-center justify-between gap-3">
    <div>
      <p class="text-sm font-semibold uppercase tracking-[0.2em] text-indigo-500">Panel</p>
      <h2 class="text-3xl font-bold text-slate-900">Tareas</h2>
      <p class="text-sm text-slate-600">Filtra, revisa y navega tus tareas activas.</p>
    </div>
    <button
      (click)="logout()"
      class="inline-flex items-center gap-2 rounded-xl border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-700 transition hover:border-rose-200 hover:bg-rose-50 hover:text-rose-700"
    >
      Salir
    </button>
  </div>

  <form
    [formGroup]="filters"
    class="grid gap-4 rounded-2xl bg-white p-4 shadow-lg shadow-indigo-50 ring-1 ring-slate-100 md:grid-cols-4"
  >
    <div class="md:col-span-1">
      <label class="block text-xs font-semibold uppercase tracking-[0.15em] text-slate-500">Proyecto</label>
      <input
        placeholder="ID del proyecto (opcional)"
        formControlName="project_id"
        class="mt-2 w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm focus:border-indigo-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-indigo-200"
      />
    </div>

    <div>
      <label class="block text-xs font-semibold uppercase tracking-[0.15em] text-slate-500">Estado</label>
      <select
        formControlName="estado"
        class="mt-2 w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm focus:border-indigo-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-indigo-200"
      >
        <option *ngFor="let e of estados" [value]="e.value">{{ e.label }}</option>
      </select>
    </div>

    <div>
      <label class="block text-xs font-semibold uppercase tracking-[0.15em] text-slate-500">Prioridad</label>
      <select
        formControlName="prioridad"
        class="mt-2 w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm focus:border-indigo-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-indigo-200"
      >
        <option *ngFor="let p of prioridades" [value]="p.value">{{ p.label }}</option>
      </select>
    </div>

    <div class="flex items-end">
      <button
        type="button"
        (click)="applyFilters()"
        [disabled]="loading"
        class="w-full rounded-xl bg-indigo-600 px-4 py-3 text-sm font-semibold text-white transition hover:bg-indigo-700 disabled:opacity-60"
      >
        {{ loading ? 'Filtrando...' : 'Aplicar filtros' }}
      </button>
    </div>
  </form>

  <div *ngIf="error" class="rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">
    {{ error }}
  </div>
  <div *ngIf="loading" class="text-sm text-slate-600">Cargando...</div>

  <div *ngIf="result && !loading" class="overflow-hidden rounded-2xl bg-white shadow-xl shadow-indigo-50 ring-1 ring-slate-100">
    <table class="min-w-full divide-y divide-slate-200">
      <thead class="bg-slate-50">
        <tr>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-[0.15em] text-slate-500">ID</th>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-[0.15em] text-slate-500">Título</th>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-[0.15em] text-slate-500">Estado</th>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-[0.15em] text-slate-500">Prioridad</th>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-[0.15em] text-slate-500">Proyecto</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-100">
        <tr *ngFor="let t of result.data" class="hover:bg-indigo-50/40">
          <td class="px-4 py-3 text-sm font-semibold text-slate-800">#{{ t.id }}</td>
          <td class="px-4 py-3">
            <a [routerLink]="['/tasks', t.id]" class="text-sm font-semibold text-indigo-600 hover:text-indigo-700">
              {{ t.titulo }}
            </a>
          </td>
          <td class="px-4 py-3">
            <span class="inline-flex rounded-full px-2.5 py-1 text-xs font-semibold"
              [ngClass]="{
                'bg-amber-100 text-amber-700': t.estado === 'en_progreso',
                'bg-emerald-100 text-emerald-700': t.estado === 'finalizada',
                'bg-slate-100 text-slate-700': t.estado === 'pendiente'
              }">
              {{ t.estado }}
            </span>
          </td>
          <td class="px-4 py-3">
            <span class="inline-flex rounded-full px-2.5 py-1 text-xs font-semibold"
              [ngClass]="{
                'bg-emerald-100 text-emerald-700': t.prioridad === 'baja',
                'bg-amber-100 text-amber-700': t.prioridad === 'media',
                'bg-rose-100 text-rose-700': t.prioridad === 'alta'
              }">
              {{ t.prioridad }}
            </span>
          </td>
          <td class="px-4 py-3 text-sm text-slate-700">{{ t.project_id || '—' }}</td>
        </tr>
      </tbody>
    </table>

    <div class="flex items-center justify-between border-t border-slate-100 bg-slate-50 px-4 py-3 text-sm text-slate-700">
      <button
        (click)="prev()"
        [disabled]="result.current_page <= 1"
        class="inline-flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 font-semibold text-slate-700 transition hover:bg-white disabled:opacity-50"
      >
        ← Anterior
      </button>
      <div class="font-semibold">
        Página {{ result.current_page }} / {{ result.last_page }} <span class="text-slate-500">(Total: {{ result.total }})</span>
      </div>
      <button
        (click)="next()"
        [disabled]="result.current_page >= result.last_page"
        class="inline-flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 font-semibold text-slate-700 transition hover:bg-white disabled:opacity-50"
      >
        Siguiente →
      </button>
    </div>
  </div>
</div>
